<!DOCTYPE html><html lang="en" ><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="Jekyll v4.0.0" /><meta property="og:title" content="Extracting tables from Wikipedia using bookmarklet" /><meta property="og:locale" content="en_US" /><meta name="description" content="Bookmarklet Wiki table extraction" /><meta property="og:description" content="Bookmarklet Wiki table extraction" /><link rel="canonical" href="http://localhost:4000/2021/01/20/wiki-table-bookmarklet" /><meta property="og:url" content="http://localhost:4000/2021/01/20/wiki-table-bookmarklet" /><meta property="og:site_name" content="DS" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-01-20T00:00:00+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Extracting tables from Wikipedia using bookmarklet" /><meta name="twitter:site" content="@" /> <script type="application/ld+json"> {"url":"http://localhost:4000/2021/01/20/wiki-table-bookmarklet","headline":"Extracting tables from Wikipedia using bookmarklet","dateModified":"2021-01-20T00:00:00+08:00","datePublished":"2021-01-20T00:00:00+08:00","description":"Bookmarklet Wiki table extraction","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2021/01/20/wiki-table-bookmarklet"},"@type":"BlogPosting","@context":"https://schema.org"}</script><title> Extracting tables from Wikipedia using bookmarklet - DS</title><link rel="shortcut icon" href="/icons/favicon.ico"><link rel="alternate" type="application/atom+xml" title="DS" href="/atom.xml"><link rel="alternate" type="application/json" title="DS" href="http://localhost:4000/feed.json" /><link rel="sitemap" type="application/xml" title="sitemap" href="/sitemap.xml" /><style> *,:after,:before{box-sizing:border-box;background-color:inherit;color:inherit;margin:0;padding:0}body{font-family:system-ui, sans-serif;-webkit-font-smoothing:antialiased;text-rendering:optimizeLegibility;line-height:1.5;font-size:1rem;color:#16171a}nav ul{border-right:1px solid #edf2f7}a{color:#000}a:hover{text-decoration:underline}pre{margin:.5rem 0;padding:.5rem}.post p{margin:.5rem 0}.post h1,.post h2,.post h3,.post h4{margin:1rem 0}.post h2:first-child,.project h2:first-child,.photo h2:first-child{margin-top:0}.meta{margin:2rem 0}code,pre{background:#ecedee}code{padding:.1rem}pre code{border:none}pre{padding:1rem;overflow-x:auto}img{max-width:100%}hr{background:#000;height:1px;border:0}header{flex-basis:10rem;flex-grow:1;position:relative}header a{text-decoration:none}header li{margin-bottom:.2rem;text-align:right;margin-right:2rem}header a.active{font-weight:bold}header,section{padding:1rem}blockquote{font-style:italic;border-left:5px solid #ececec;padding-left:1rem}h1,h2,h3,h4,h5{line-height:1;margin:1rem 0;font-weight:600}section h1:first-child{margin-top:0}strong,b{font-weight:bold}.photos ul{list-style:none}.photos li{margin-bottom:1.5rem}.photo picture,.project picture{margin-bottom:0.5rem}.posts ul,header ul{list-style:none}.posts li{align-items:center;display:flex;justify-content:space-between;margin-bottom:.5rem}.posts li a,.posts li div,.projects li a{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;text-decoration:none}.posts li time,.projects li time{padding-left:1rem;white-space:nowrap;font-variant-numeric:tabular-nums}main{display:flex;flex-wrap:wrap;max-width:60rem;margin:2rem auto;padding:1rem}@media screen and (max-width: 45rem){header li{display:inline;margin-right:1rem}.logo{padding-bottom:1rem}header ul{border-bottom:1px solid #edf2f7;padding-bottom:2rem}nav ul{border-right:0px}.photos ul{margin-top:0.5rem}}section{flex-basis:0;flex-grow:999;min-width:70%;display:flex;flex-direction:column}figcaption{font-size:smaller}</style><script async src="https://www.googletagmanager.com/gtag/js?id=G-4ZFHRRPN4N"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-4ZFHRRPN4N'); </script></head><body><main role="main"><header role="banner"> <!--<h1 class="logo">DS</h1>--><nav role="navigation"><ul><li><a href="/" >Posts</a></li><li><a href="/about" >About</a></li><li><a href="/search" >Search</a></li></ul></nav></header><section class="post"><h2>Extracting tables from Wikipedia using bookmarklet</h2><p>Continuing the theme of bookmarklets from my previous <a href="https://darensin01.github.io/2021/01/13/bto-bookmarklet" target="_blank">post</a>, I decided to create another bookmarklet to extract Wikipedia tables into CSV files. A similar tool can be found <a href="https://wikitable2csv.ggor.de/" target="_blank">here</a>.</p><p>Credits to <a href="https://stackoverflow.com/a/29304414/6621003" target="_blank">this Stack Overflow answer</a> for the code to download JavaScript arrays as CSV files. Link to this project’s Github repository <a href="https://github.com/darensin01/wiki-table-to-csv" target="_blank">here</a>.</p><h2 id="why-this-bookmarklet">Why this bookmarklet?</h2><p>In some of my Data Science projects, I often require data from Wikipedia pages. Instead of manually copying, pasting and formatting the tables one by one, I thought it will be great to have a bookmarklet that helps to download the data that I need into a CSV file, that can be read in by libraries such as <code>pandas</code>. It’s also a great way to find out how to use a bookmarklet to download content as a file.</p><h2 id="features">Features</h2><ul><li>Automatic extraction of simple tables in Wikipedia into CSV</li><li>Retains structure of tables</li><li>CSV files are named according to caption of the tables. If caption is not available, they will be named after the table’s enclosing header</li></ul><h2 id="how-to-get-the-bookmarklet">How to get the bookmarklet?</h2><ul><li>Toggle your browser’s bookmark bar (CTRL + Shift + B on Windows/Chrome).</li><li>Drag the following link onto your bookmarks bar: <a href="javascript: (function() {let download = function(content, fileName, mimeType) {let a = document.createElement('a');mimeType = mimeType || 'application/octet-stream';if (navigator.msSaveBlob) { navigator.msSaveBlob(new Blob([content], { type: mimeType }), fileName); } else if (URL &amp;&amp; 'download' in a) { a.href = URL.createObjectURL(new Blob([content], { type: mimeType })); a.setAttribute('download', fileName); document.body.appendChild(a); a.click(); document.body.removeChild(a); } else { location.href = 'data:application/octet-stream,' + encodeURIComponent(content); } };let sanitise_filename = function(name) { let sanitised_name = name.toLowerCase().replace(/[\/\?&lt;&gt;\\:\*\|&quot;:]/g, '').replaceAll(' ', '_'); return sanitised_name.substring(0, 251) + '.csv'; }; let clean_text = function(t) {return t.replace(/[.,\/#!$%\^&amp;\*;:{}=\-_`~()]/g,&quot;&quot;).replace(/\s{2,}/g,&quot; &quot;);};let css_selector_table = &quot;table[class~='wikitable']&quot;;let tables = document.querySelectorAll(css_selector_table);for (let i = 0; i &lt; tables.length; i++) {let csv_content = [];let table = tables[i];if (table.style.fontSize === '90%') {continue;}let csv_filename = '';let caption = table.querySelector(&quot;caption&quot;);if (caption !== null) {csv_filename = clean_text(caption.innerText)} else {let cur_prev_sibling = table.previousElementSibling;while (cur_prev_sibling.nodeName[0] != &quot;H&quot;) {cur_prev_sibling = cur_prev_sibling.previousElementSibling;}let headline = cur_prev_sibling.querySelector(&quot;span[class='mw-headline']&quot;);csv_filename = clean_text(headline.innerText);}let headers = table.querySelectorAll('thead &gt; tr &gt; th');if (headers.length &gt; 0) {headers = Array.from(headers).map(h =&gt; h.innerText).join(',');csv_content.push(headers);}let table_rows = table.querySelectorAll('tbody &gt; tr');if (table_rows !== null) {for (let j = 0; j &lt; table_rows.length; j++) {let row = table_rows[j].querySelectorAll('th,td');let content = Array.from(row).map(h =&gt; {let text = h.innerText.replaceAll('&quot;', '\'');let text_array = text.split(&quot;\n&quot;);if (text_array.length &gt; 1) {text = text_array.join(&quot;|&quot;);}return '&quot;' + text + '&quot;';});csv_content.push(content.join(','));}} if (csv_content.length &gt; 0) { csv_content = csv_content.join(&quot;\r\n&quot;); download(csv_content, sanitise_filename(csv_filename), 'text/csv;encoding:utf-8'); } } })();" style="border-radius: 7px; background-color: #A9A9A9; padding: 2px; text-decoration: none; font-size: 150%; margin: 5px;">wiki-table</a></li><li><em>Optional</em>: Rename the new bookmark as whatever you want.</li></ul><h2 id="using-the-bookmarklet">Using the bookmarklet</h2><h3 id="example-1">Example 1</h3><ul><li>As an example, suppose I want to extract the tables for this Wikipedia page: <a href="https://en.wikipedia.org/wiki/Singaporean_Mahjong_scoring_rules" target="_blank">Singaporean Mahjong scoring rules</a>. The first table that we see is the following:</li></ul><blockquote><p><img src="https://github.com/darensin01/wiki-table-to-csv/blob/main/screenshots/eg_table_1.PNG?raw=true" width="600px" /></p></blockquote><ul><li>Subsequent tables are as follow:</li></ul><blockquote><p><img src="https://github.com/darensin01/wiki-table-to-csv/blob/main/screenshots/eg_table_2.PNG?raw=true" width="500px" /></p></blockquote><ul><li><p>There are 3 tables in total. Click on the bookmarklet, and it will automatically extract the 3 tables above as 3 separate CSV files. Remember to allow your browser to download multiple files at the same time.</p></li><li><p>These 3 tables happen to have no caption, and they fall under the same header (“Scoring points”). I decided to name the downloaded files as <code>scoring_points.csv</code>, and the downloaded files will automatically be renamed as <code>scoring_points.csv</code>, <code>scoring_points (1).csv</code> and <code>scoring_points (2).csv</code>, due to duplicate file names.</p></li><li><p>This is how one of the CSV files look like, with 2 columns and 6 rows:</p></li></ul><blockquote><p><img src="https://github.com/darensin01/wiki-table-to-csv/blob/main/screenshots/eg_table_result_1.PNG?raw=true" width="400px" /></p></blockquote><h3 id="example-2">Example 2</h3><ul><li>As another example, suppose I want to extract from: <a href="https://en.wikipedia.org/wiki/List_of_songs_recorded_by_Lady_Gaga" target="_blank">List of songs recorded by Lady Gaga</a>. Here’s an example table:</li></ul><blockquote><p><img src="https://github.com/darensin01/wiki-table-to-csv/blob/main/screenshots/eg_table_3.PNG?raw=true" width="800px" /></p></blockquote><ul><li><p>A <em>caption</em> exists for this table, which is enclosed in the red box above. To make the filename of the CSV file more readable and intuitive, I decided to name the file as the caption of the table. This table is saved as <code>name_of_song_featured_performers_writers_originating_album_and_year_released.csv</code>.</p></li><li><p>Note that there is a small table above, with the caption <code>Key</code>. In this context, I regarded this small table as non-essential. I used the <code>fontSize</code> property of the caption to automatically ignore this table.</p></li></ul><h2 id="gotchasto-do">Gotchas/To-do</h2><p>For this section, see the original table from <a href="https://en.wikipedia.org/wiki/H%C3%A9roes_del_Silencio_discography" target="_blank">this Wikipedia page</a>…</p><blockquote><p><img src="https://github.com/darensin01/wiki-table-to-csv/blob/main/screenshots/eg_table_4.png?raw=true" width="800px" /></p></blockquote><p>… And its resulting CSV file:</p><blockquote><p><img src="https://github.com/darensin01/wiki-table-to-csv/blob/main/screenshots/eg_table_result_2.PNG?raw=true" width="800px" /></p></blockquote><h3 id="multi-line-content">Multi-line content</h3><ul><li>In the event where the content of a cell is separated by new lines, I decided to replace these spaces with a single pipe, in the event where the new lines are essential. See the result enclosed in light blue box. Downstream data processing tasks can recover the spaces again via methods such as <code>split</code>.</li></ul><h3 id="multi-rowmulti-column-tables">Multi-row/multi-column tables</h3><ul><li>This bookmarklet is unable to extract properly more sophisticated tables. For example, the table above splits the 3rd column into 2 separate rows, and this messes the resulting CSV file. The CSV file interprets the table as having 4 columns (see row 1 of result), and interprets the content in the multi-column as a separate row (see content enclosed in red box).</li></ul><h2 id="conclusion">Conclusion</h2><p>This bookmarklet is convenient to extract <em>simple</em> tables into CSV files, with some elements of automatic naming, so that one does not have to manually rename the CSV files into interpretable names. For more complex tables, more work will need to be done.</p><p>Let me know in the Disqus section below if you’ve used this bookmarklet, and what you think of it!</p><span class="meta"><time datetime="2021-01-20T00:00:00+08:00">January 20, 2021</time> &middot; <a href="/tag/bookmarklet">bookmarklet</a>, <a href="/tag/automation">automation</a>, <a href="/tag/wikipedia">wikipedia</a>, <a href="/tag/side-project">side-project</a></span></section><section class="disqus"><div id="disqus_thread"></div><script type="text/javascript"> var disqus_shortname = "https-darensin01-github-io"; var disqus_identifier = "/2021/01/20/wiki-table-bookmarklet"; (function() { var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true; dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js'; (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq); })(); </script> <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript> <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a></section></main></body></html>
